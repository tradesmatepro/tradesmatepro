{"ast":null,"code":"import { supabase, adminDeleteUser } from '../supabaseClient';\n\n/**\n * User Management Service\n * Handles user deletion and related operations\n */\nexport class UserService {\n  /**\n   * Delete a single user and all associated data\n   * @param {string} userId - User ID to delete\n   * @param {string} userEmail - User email (for logging)\n   * @returns {object} - Success status and message\n   */\n  static async deleteUser(userId, userEmail) {\n    try {\n      console.log('üóëÔ∏è Starting user deletion for ID:', userId, 'Email:', userEmail);\n\n      // Step 1: Delete auth user (using secure Edge Function)\n      try {\n        console.log('üîê Deleting auth user via Edge Function:', userEmail);\n        await adminDeleteUser(userId);\n        console.log('‚úÖ Auth user deleted:', userEmail);\n      } catch (error) {\n        console.error('‚ùå Error deleting auth user:', userEmail, error);\n        // Continue with profile deletion even if auth deletion fails\n      }\n\n      // Step 2: Delete user profile\n      const {\n        error: profileDeleteError\n      } = await supabase.from('profiles').delete().eq('id', userId);\n      if (profileDeleteError) {\n        console.error('‚ùå Error deleting profile:', profileDeleteError);\n        throw new Error(`Failed to delete user profile: ${profileDeleteError.message}`);\n      }\n      console.log('‚úÖ User profile deleted');\n\n      // Step 3: Delete user record from users table\n      const {\n        error: userDeleteError\n      } = await supabase.from('users').delete().eq('id', userId);\n      if (userDeleteError) {\n        console.error('‚ùå Error deleting user record:', userDeleteError);\n        throw new Error(`Failed to delete user record: ${userDeleteError.message}`);\n      }\n      console.log('‚úÖ User record deleted');\n\n      // Step 4: Delete employee record if exists (cascade should handle, but be explicit)\n      try {\n        const {\n          error: employeeDeleteError\n        } = await supabase.from('employees').delete().eq('user_id', userId);\n        if (!employeeDeleteError) {\n          console.log('‚úÖ Employee record deleted (if existed)');\n        }\n      } catch (e) {\n        console.warn('‚ö†Ô∏è Employee deletion skipped (table may not exist):', e.message);\n      }\n      console.log('‚úÖ User deletion completed successfully');\n      return {\n        success: true,\n        message: `User ${userEmail} deleted successfully`\n      };\n    } catch (error) {\n      console.error('‚ùå User deletion workflow failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Delete multiple users at once\n   * @param {array} userIds - Array of user IDs to delete\n   * @returns {object} - Success status and message\n   */\n  static async deleteMultipleUsers(userIds) {\n    try {\n      console.log('üóëÔ∏è Starting batch user deletion for', userIds.length, 'users');\n      let successCount = 0;\n      let failureCount = 0;\n      const failures = [];\n      for (const userId of userIds) {\n        try {\n          await this.deleteUser(userId, `User ${userId}`);\n          successCount++;\n        } catch (error) {\n          console.error('‚ùå Failed to delete user:', userId, error);\n          failureCount++;\n          failures.push({\n            userId,\n            error: error.message\n          });\n        }\n      }\n      console.log(`‚úÖ Batch deletion complete: ${successCount} succeeded, ${failureCount} failed`);\n      return {\n        success: failureCount === 0,\n        message: `Deleted ${successCount} users${failureCount > 0 ? `, ${failureCount} failed` : ''}`,\n        successCount,\n        failureCount,\n        failures\n      };\n    } catch (error) {\n      console.error('‚ùå Batch user deletion workflow failed:', error);\n      throw error;\n    }\n  }\n}","map":{"version":3,"names":["supabase","adminDeleteUser","UserService","deleteUser","userId","userEmail","console","log","error","profileDeleteError","from","delete","eq","Error","message","userDeleteError","employeeDeleteError","e","warn","success","deleteMultipleUsers","userIds","length","successCount","failureCount","failures","push"],"sources":["D:/TradeMate Pro Webapp/admin-dashboard/src/services/UserService.js"],"sourcesContent":["import { supabase, adminDeleteUser } from '../supabaseClient';\n\n/**\n * User Management Service\n * Handles user deletion and related operations\n */\nexport class UserService {\n\n  /**\n   * Delete a single user and all associated data\n   * @param {string} userId - User ID to delete\n   * @param {string} userEmail - User email (for logging)\n   * @returns {object} - Success status and message\n   */\n  static async deleteUser(userId, userEmail) {\n    try {\n      console.log('üóëÔ∏è Starting user deletion for ID:', userId, 'Email:', userEmail);\n\n      // Step 1: Delete auth user (using secure Edge Function)\n      try {\n        console.log('üîê Deleting auth user via Edge Function:', userEmail);\n        await adminDeleteUser(userId);\n        console.log('‚úÖ Auth user deleted:', userEmail);\n      } catch (error) {\n        console.error('‚ùå Error deleting auth user:', userEmail, error);\n        // Continue with profile deletion even if auth deletion fails\n      }\n\n      // Step 2: Delete user profile\n      const { error: profileDeleteError } = await supabase\n        .from('profiles')\n        .delete()\n        .eq('id', userId);\n\n      if (profileDeleteError) {\n        console.error('‚ùå Error deleting profile:', profileDeleteError);\n        throw new Error(`Failed to delete user profile: ${profileDeleteError.message}`);\n      }\n\n      console.log('‚úÖ User profile deleted');\n\n      // Step 3: Delete user record from users table\n      const { error: userDeleteError } = await supabase\n        .from('users')\n        .delete()\n        .eq('id', userId);\n\n      if (userDeleteError) {\n        console.error('‚ùå Error deleting user record:', userDeleteError);\n        throw new Error(`Failed to delete user record: ${userDeleteError.message}`);\n      }\n\n      console.log('‚úÖ User record deleted');\n\n      // Step 4: Delete employee record if exists (cascade should handle, but be explicit)\n      try {\n        const { error: employeeDeleteError } = await supabase\n          .from('employees')\n          .delete()\n          .eq('user_id', userId);\n\n        if (!employeeDeleteError) {\n          console.log('‚úÖ Employee record deleted (if existed)');\n        }\n      } catch (e) {\n        console.warn('‚ö†Ô∏è Employee deletion skipped (table may not exist):', e.message);\n      }\n\n      console.log('‚úÖ User deletion completed successfully');\n\n      return {\n        success: true,\n        message: `User ${userEmail} deleted successfully`\n      };\n\n    } catch (error) {\n      console.error('‚ùå User deletion workflow failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Delete multiple users at once\n   * @param {array} userIds - Array of user IDs to delete\n   * @returns {object} - Success status and message\n   */\n  static async deleteMultipleUsers(userIds) {\n    try {\n      console.log('üóëÔ∏è Starting batch user deletion for', userIds.length, 'users');\n\n      let successCount = 0;\n      let failureCount = 0;\n      const failures = [];\n\n      for (const userId of userIds) {\n        try {\n          await this.deleteUser(userId, `User ${userId}`);\n          successCount++;\n        } catch (error) {\n          console.error('‚ùå Failed to delete user:', userId, error);\n          failureCount++;\n          failures.push({ userId, error: error.message });\n        }\n      }\n\n      console.log(`‚úÖ Batch deletion complete: ${successCount} succeeded, ${failureCount} failed`);\n\n      return {\n        success: failureCount === 0,\n        message: `Deleted ${successCount} users${failureCount > 0 ? `, ${failureCount} failed` : ''}`,\n        successCount,\n        failureCount,\n        failures\n      };\n\n    } catch (error) {\n      console.error('‚ùå Batch user deletion workflow failed:', error);\n      throw error;\n    }\n  }\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}