{"ast":null,"code":"import React,{useState,useEffect}from'react';import{supabase,adminListUsers,adminListUsersLocal,hasAdminBypass}from'../supabaseClient';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserList=()=>{const[users,setUsers]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{loadUsers();},[]);const loadUsers=async()=>{try{setLoading(true);setError(null);console.log('🔍 Fetching all users...');// 1) DEV-ONLY: If service key is present, use local admin bypass (no Edge Function needed)\nif(hasAdminBypass){try{const adminData=await adminListUsersLocal({limit:500});const rows=Array.isArray(adminData===null||adminData===void 0?void 0:adminData.users)?adminData.users:[];if(rows.length>0){setUsers(rows);return;}}catch(e){console.warn('Admin bypass failed, will try Edge Function next:',(e===null||e===void 0?void 0:e.message)||e);}}// 2) Prefer privileged Edge Function for APP_OWNER to see all users\ntry{const adminData=await adminListUsers({limit:500});let rows=Array.isArray(adminData===null||adminData===void 0?void 0:adminData.users)?adminData.users:Array.isArray(adminData)?adminData:[];if(rows.length>0){// Normalize fields expected by UI\nconst normalized=rows.map(r=>{const profile=r.profile||r.profiles||{};const company=r.company||r.companies||(r.company_name?{name:r.company_name,id:r.company_id}:null);const display_name=r.display_name||r.full_name||[profile.first_name,profile.last_name].filter(Boolean).join(' ').trim();return{id:r.id,email:r.email,role:r.role,status:r.status,created_at:r.created_at,company_id:r.company_id,company,display_name,phone:r.phone||profile.phone||null};});setUsers(normalized);return;}}catch(e){console.warn('Admin Edge Function not available or failed, falling back to direct queries:',(e===null||e===void 0?void 0:e.message)||e);}// 3) Fallback: Query minimal, guaranteed columns only (RLS may restrict results)\nconst{data:users,error}=await supabase.from('users').select('id, email, role, status, created_at, company_id').order('created_at',{ascending:false});if(error){console.error('❌ Database query failed:',error);throw new Error(\"Failed to fetch users: \".concat(error.message));}console.log('✅ Users fetched successfully:',(users===null||users===void 0?void 0:users.length)||0);// Enrich with profile names/phone using a separate query with select('*')\nif(users&&users.length>0){const userIds=users.map(u=>u.id);const{data:profiles,error:profileErr}=await supabase.from('profiles').select('*').in('id',userIds);if(!profileErr&&Array.isArray(profiles)){const profileMap={};profiles.forEach(p=>{profileMap[p.id]=p;});users.forEach(u=>{const p=profileMap[u.id]||{};const fullName=[p.first_name,p.last_name].filter(Boolean).join(' ').trim();if(fullName)u.display_name=fullName;if(p.phone)u.phone=p.phone;});}// Fetch company names separately to avoid PostgREST relationship issues\nconst companyIds=[...new Set(users.map(u=>u.company_id).filter(Boolean))];if(companyIds.length>0){const{data:companies}=await supabase.from('companies').select('id, name').in('id',companyIds);const companyMap={};companies===null||companies===void 0?void 0:companies.forEach(c=>{companyMap[c.id]=c;});users.forEach(u=>{u.company=companyMap[u.company_id]||null;});}}setUsers(users||[]);}catch(error){console.error('Error loading users:',error);setError(error.message);}finally{setLoading(false);}};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});};const getRoleBadgeColor=role=>{switch(role){case'APP_OWNER':return'bg-purple-100 text-purple-800';case'OWNER':return'bg-blue-100 text-blue-800';case'ADMIN':return'bg-green-100 text-green-800';case'EMPLOYEE':return'bg-gray-100 text-gray-800';default:return'bg-gray-100 text-gray-800';}};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center py-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-3 text-gray-600\",children:\"Loading users...\"})]});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-md p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-red-800\",children:\"Error Loading Users\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-sm text-red-700\",children:/*#__PURE__*/_jsx(\"p\",{children:error})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:loadUsers,className:\"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200\",children:\"Try Again\"})})]})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-center\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:\"User Profiles\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:\"All user profiles in the system\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Total Users\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:users.length})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Owners\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:users.filter(u=>u.role==='OWNER'||u.role==='APP_OWNER').length})]})})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow overflow-hidden sm:rounded-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-5 sm:px-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900\",children:\"All User Profiles\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 max-w-2xl text-sm text-gray-500\",children:\"Complete list of user profiles from the profiles table\"})]}),users.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"mx-auto h-12 w-12 text-gray-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900\",children:\"No users found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:\"No user profiles in the database.\"})]}):/*#__PURE__*/_jsx(\"ul\",{className:\"divide-y divide-gray-200\",children:users.map(user=>{var _user$company;const displayName=user.display_name||user.email||'Unknown User';const initial=displayName.charAt(0).toUpperCase();return/*#__PURE__*/_jsx(\"li\",{className:\"px-4 py-4 sm:px-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-10 w-10 bg-gray-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-600\",children:initial})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:displayName}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:user.email}),user.phone&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"\\uD83D\\uDCDE \",user.phone]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"Company: \",((_user$company=user.company)===null||_user$company===void 0?void 0:_user$company.name)||'No company']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(getRoleBadgeColor(user.role)),children:user.role}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:formatDate(user.created_at)})]})]})},user.id);})})]})]});};export default UserList;","map":{"version":3,"names":["React","useState","useEffect","supabase","adminListUsers","adminListUsersLocal","hasAdminBypass","jsx","_jsx","jsxs","_jsxs","UserList","users","setUsers","loading","setLoading","error","setError","loadUsers","console","log","adminData","limit","rows","Array","isArray","length","e","warn","message","normalized","map","r","profile","profiles","company","companies","company_name","name","id","company_id","display_name","full_name","first_name","last_name","filter","Boolean","join","trim","email","role","status","created_at","phone","data","from","select","order","ascending","Error","concat","userIds","u","profileErr","in","profileMap","forEach","p","fullName","companyIds","Set","companyMap","c","formatDate","dateString","Date","toLocaleDateString","year","month","day","getRoleBadgeColor","className","children","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","user","_user$company","displayName","initial","charAt","toUpperCase"],"sources":["D:/TradeMate Pro Webapp/admin-dashboard/src/pages/UserList.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { supabase, adminListUsers, adminListUsersLocal, hasAdminBypass } from '../supabaseClient';\n\nconst UserList = () => {\n  const [users, setUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    loadUsers();\n  }, []);\n\n  const loadUsers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      console.log('🔍 Fetching all users...');\n\n      // 1) DEV-ONLY: If service key is present, use local admin bypass (no Edge Function needed)\n      if (hasAdminBypass) {\n        try {\n          const adminData = await adminListUsersLocal({ limit: 500 });\n          const rows = Array.isArray(adminData?.users) ? adminData.users : [];\n          if (rows.length > 0) {\n            setUsers(rows);\n            return;\n          }\n        } catch (e) {\n          console.warn('Admin bypass failed, will try Edge Function next:', e?.message || e);\n        }\n      }\n\n      // 2) Prefer privileged Edge Function for APP_OWNER to see all users\n      try {\n        const adminData = await adminListUsers({ limit: 500 });\n        let rows = Array.isArray(adminData?.users) ? adminData.users : Array.isArray(adminData) ? adminData : [];\n        if (rows.length > 0) {\n          // Normalize fields expected by UI\n          const normalized = rows.map(r => {\n            const profile = r.profile || r.profiles || {};\n            const company = r.company || r.companies || (r.company_name ? { name: r.company_name, id: r.company_id } : null);\n            const display_name = r.display_name || r.full_name || [profile.first_name, profile.last_name].filter(Boolean).join(' ').trim();\n            return {\n              id: r.id,\n              email: r.email,\n              role: r.role,\n              status: r.status,\n              created_at: r.created_at,\n              company_id: r.company_id,\n              company,\n              display_name,\n              phone: r.phone || profile.phone || null,\n            };\n          });\n          setUsers(normalized);\n          return;\n        }\n      } catch (e) {\n        console.warn('Admin Edge Function not available or failed, falling back to direct queries:', e?.message || e);\n      }\n\n      // 3) Fallback: Query minimal, guaranteed columns only (RLS may restrict results)\n      const { data: users, error } = await supabase\n        .from('users')\n        .select('id, email, role, status, created_at, company_id')\n        .order('created_at', { ascending: false});\n\n      if (error) {\n        console.error('❌ Database query failed:', error);\n        throw new Error(`Failed to fetch users: ${error.message}`);\n      }\n\n      console.log('✅ Users fetched successfully:', users?.length || 0);\n\n      // Enrich with profile names/phone using a separate query with select('*')\n      if (users && users.length > 0) {\n        const userIds = users.map(u => u.id);\n        const { data: profiles, error: profileErr } = await supabase\n          .from('profiles')\n          .select('*')\n          .in('id', userIds);\n        if (!profileErr && Array.isArray(profiles)) {\n          const profileMap = {};\n          profiles.forEach(p => { profileMap[p.id] = p; });\n          users.forEach(u => {\n            const p = profileMap[u.id] || {};\n            const fullName = [p.first_name, p.last_name].filter(Boolean).join(' ').trim();\n            if (fullName) u.display_name = fullName;\n            if (p.phone) u.phone = p.phone;\n          });\n        }\n\n        // Fetch company names separately to avoid PostgREST relationship issues\n        const companyIds = [...new Set(users.map(u => u.company_id).filter(Boolean))];\n        if (companyIds.length > 0) {\n          const { data: companies } = await supabase\n            .from('companies')\n            .select('id, name')\n            .in('id', companyIds);\n          const companyMap = {};\n          companies?.forEach(c => { companyMap[c.id] = c; });\n          users.forEach(u => { u.company = companyMap[u.company_id] || null; });\n        }\n      }\n\n      setUsers(users || []);\n\n    } catch (error) {\n      console.error('Error loading users:', error);\n      setError(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatDate = (dateString) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  const getRoleBadgeColor = (role) => {\n    switch (role) {\n      case 'APP_OWNER': return 'bg-purple-100 text-purple-800';\n      case 'OWNER': return 'bg-blue-100 text-blue-800';\n      case 'ADMIN': return 'bg-green-100 text-green-800';\n      case 'EMPLOYEE': return 'bg-gray-100 text-gray-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n        <span className=\"ml-3 text-gray-600\">Loading users...</span>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n        <div className=\"flex\">\n          <div className=\"ml-3\">\n            <h3 className=\"text-sm font-medium text-red-800\">Error Loading Users</h3>\n            <div className=\"mt-2 text-sm text-red-700\">\n              <p>{error}</p>\n            </div>\n            <div className=\"mt-4\">\n              <button\n                onClick={loadUsers}\n                className=\"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200\"\n              >\n                Try Again\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">User Profiles</h1>\n          <p className=\"mt-1 text-sm text-gray-500\">\n            All user profiles in the system\n          </p>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\n          <div className=\"p-5\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center\">\n                  <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                  </svg>\n                </div>\n              </div>\n              <div className=\"ml-5 w-0 flex-1\">\n                <dl>\n                  <dt className=\"text-sm font-medium text-gray-500 truncate\">Total Users</dt>\n                  <dd className=\"text-lg font-medium text-gray-900\">{users.length}</dd>\n                </dl>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\n          <div className=\"p-5\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center\">\n                  <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                  </svg>\n                </div>\n              </div>\n              <div className=\"ml-5 w-0 flex-1\">\n                <dl>\n                  <dt className=\"text-sm font-medium text-gray-500 truncate\">Owners</dt>\n                  <dd className=\"text-lg font-medium text-gray-900\">\n                    {users.filter(u => u.role === 'OWNER' || u.role === 'APP_OWNER').length}\n                  </dd>\n                </dl>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Users Table */}\n      <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n        <div className=\"px-4 py-5 sm:px-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900\">All User Profiles</h3>\n          <p className=\"mt-1 max-w-2xl text-sm text-gray-500\">\n            Complete list of user profiles from the profiles table\n          </p>\n        </div>\n        \n        {users.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <svg className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n            </svg>\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No users found</h3>\n            <p className=\"mt-1 text-sm text-gray-500\">No user profiles in the database.</p>\n          </div>\n        ) : (\n          <ul className=\"divide-y divide-gray-200\">\n            {users.map((user) => {\n              const displayName = user.display_name || user.email || 'Unknown User';\n              const initial = displayName.charAt(0).toUpperCase();\n\n              return (\n              <li key={user.id} className=\"px-4 py-4 sm:px-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <div className=\"h-10 w-10 bg-gray-100 rounded-full flex items-center justify-center\">\n                        <span className=\"text-sm font-medium text-gray-600\">\n                          {initial}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"ml-4\">\n                      <div className=\"text-sm font-medium text-gray-900\">\n                        {displayName}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {user.email}\n                      </div>\n                      {user.phone && (\n                        <div className=\"text-sm text-gray-500\">\n                          📞 {user.phone}\n                        </div>\n                      )}\n                      <div className=\"text-sm text-gray-500\">\n                        Company: {user.company?.name || 'No company'}\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-4\">\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getRoleBadgeColor(user.role)}`}>\n                      {user.role}\n                    </span>\n                    <div className=\"text-sm text-gray-500\">\n                      {formatDate(user.created_at)}\n                    </div>\n                  </div>\n                </div>\n              </li>\n              );\n            })}\n          </ul>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default UserList;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}