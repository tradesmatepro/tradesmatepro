# üéØ Quick Reference: Frontend vs Backend Responsibilities

## ‚úÖ FRONTEND (Source of Truth)

### **Calculations**
- ‚úÖ Subtotals
- ‚úÖ Tax amounts
- ‚úÖ Discounts
- ‚úÖ Deposits
- ‚úÖ Totals
- ‚úÖ Line item prices
- ‚úÖ Markup percentages

### **Business Logic**
- ‚úÖ Pricing rules
- ‚úÖ Discount logic
- ‚úÖ Tax calculations
- ‚úÖ Payment splits
- ‚úÖ Workflow steps
- ‚úÖ Validation rules

### **User Experience**
- ‚úÖ Instant feedback
- ‚úÖ Real-time updates
- ‚úÖ Offline support
- ‚úÖ Optimistic UI

---

## ‚úÖ BACKEND (Validation Only)

### **Validation (Constraints)**
- ‚úÖ Math correctness: `total = subtotal + tax`
- ‚úÖ Positive amounts: `total >= 0`
- ‚úÖ Date logic: `end_date >= start_date`
- ‚úÖ Required fields: `customer_id NOT NULL`

### **Metadata (Triggers)**
- ‚úÖ Auto-timestamps: `updated_at = NOW()`
- ‚úÖ Audit logging: Log changes
- ‚úÖ Auto-numbering: Generate invoice numbers
- ‚úÖ Status validation: Enforce transitions

### **Storage**
- ‚úÖ Store data as-is
- ‚úÖ Enforce foreign keys
- ‚úÖ Maintain referential integrity

---

## ‚ùå BACKEND DOES NOT

### **Never Recalculate**
- ‚ùå Totals
- ‚ùå Taxes
- ‚ùå Discounts
- ‚ùå Subtotals
- ‚ùå Any financial data

### **Never Override**
- ‚ùå Frontend calculations
- ‚ùå User input
- ‚ùå Business logic

### **Never Implement**
- ‚ùå Complex workflows
- ‚ùå Pricing rules
- ‚ùå Business logic

---

## üéØ Decision Tree

### **Should This Be a Database Trigger?**

```
Is it metadata? (timestamp, audit log, ID generation)
‚îú‚îÄ YES ‚Üí ‚úÖ Use trigger
‚îî‚îÄ NO ‚Üí Is it validation? (constraint check)
    ‚îú‚îÄ YES ‚Üí ‚úÖ Use constraint (not trigger!)
    ‚îî‚îÄ NO ‚Üí Is it calculation?
        ‚îú‚îÄ YES ‚Üí ‚ùå Frontend responsibility
        ‚îî‚îÄ NO ‚Üí Is it business logic?
            ‚îú‚îÄ YES ‚Üí ‚ùå Frontend responsibility
            ‚îî‚îÄ NO ‚Üí ‚ö†Ô∏è Review case-by-case
```

---

## üìä Examples

### **‚úÖ GOOD: Frontend Calculates**
```javascript
// Frontend
const subtotal = lineItems.reduce((sum, item) => sum + item.total, 0);
const taxAmount = subtotal * taxRate;
const total = subtotal + taxAmount;

// Send to backend
await api.updateQuote({
  subtotal,
  taxAmount,
  total
});
```

```sql
-- Backend validates
ALTER TABLE quotes
ADD CONSTRAINT chk_total_correct
CHECK (total = subtotal + tax_amount);
```

### **‚ùå BAD: Backend Recalculates**
```sql
-- DON'T DO THIS!
CREATE TRIGGER recalc_totals
AFTER INSERT ON line_items
FOR EACH ROW
BEGIN
  UPDATE quotes SET total = (SELECT SUM(price) FROM line_items);
END;
```

---

## üöÄ Migration Checklist

### **For Each Trigger:**

1. **Identify category:**
   - Metadata? ‚Üí Keep
   - Validation? ‚Üí Convert to constraint
   - Calculation? ‚Üí Disable, move to frontend
   - Business logic? ‚Üí Disable, move to frontend

2. **If disabling:**
   - Check if frontend already does it
   - If not, implement in frontend first
   - Then disable trigger
   - Test thoroughly

3. **Document:**
   - Why it was disabled
   - Where logic moved to
   - Date of change

---

## üí° Remember

**Frontend = Smart**
- Calculates everything
- Handles business logic
- Provides UX

**Backend = Dumb + Safe**
- Stores data
- Validates correctness
- Enforces integrity

**Result = Fast + Reliable**
- Instant feedback
- Offline support
- Data integrity
- Easy to debug

---

## üéâ Quick Wins

### **Already Done:**
- ‚úÖ Disabled `trigger_calculate_work_order_totals`
- ‚úÖ Disabled `trigger_calculate_invoice_totals`
- ‚úÖ Quote updates work!

### **Next Steps:**
- [ ] Review deposit calculation trigger
- [ ] Review discount calculation trigger
- [ ] Review payment tracking trigger
- [ ] Test invoice updates

### **Long Term:**
- [ ] Add offline support
- [ ] Optimize frontend calculations
- [ ] Performance monitoring

