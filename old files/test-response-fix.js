// Test script to verify the response loading fix
// Run this in browser console on marketplace page

window.testResponseFix = {
  async testResponseLoading() {
    console.log('üîß === TESTING RESPONSE LOADING FIX ===');
    
    // Find a request with response_count > 0
    const requestCards = document.querySelectorAll('[class*="response_count"]');
    console.log('üîç Found request cards:', requestCards.length);
    
    // Look for request cards that show response counts
    const requestsWithResponses = Array.from(document.querySelectorAll('div')).filter(div => {
      const text = div.textContent;
      return text.includes('response') && (text.includes('/') || text.includes('Response'));
    });
    
    console.log('üîç Found potential request cards with responses:', requestsWithResponses.length);
    
    if (requestsWithResponses.length > 0) {
      console.log('üîç First request card text:', requestsWithResponses[0].textContent);
      
      // Try to click on the first request card to open the modal
      const clickableCard = requestsWithResponses[0].closest('[class*="cursor-pointer"]') || 
                           requestsWithResponses[0].closest('div[onclick]') ||
                           requestsWithResponses[0];
      
      if (clickableCard) {
        console.log('üîç Clicking on request card to test modal...');
        clickableCard.click();
        
        // Wait a moment for the modal to load
        setTimeout(() => {
          const modal = document.querySelector('[class*="fixed"][class*="inset-0"]');
          if (modal) {
            console.log('‚úÖ Modal opened successfully');
            console.log('üîç Modal content:', modal.textContent.substring(0, 200) + '...');
            
            // Look for response count in modal
            if (modal.textContent.includes('0 contractor')) {
              console.log('‚ùå Still showing 0 contractors - fix may not be working');
            } else if (modal.textContent.includes('contractor')) {
              console.log('‚úÖ Modal shows contractor responses');
            }
          } else {
            console.log('‚ùå Modal did not open');
          }
        }, 2000);
      }
    } else {
      console.log('‚ö†Ô∏è No request cards with responses found. Try creating a test response first.');
    }
  },
  
  async createTestResponse() {
    console.log('üîß === CREATING TEST RESPONSE ===');
    
    // This would need to be implemented based on the actual UI
    console.log('‚ö†Ô∏è Test response creation not implemented yet');
    console.log('üí° Manually create a response through the UI, then run testResponseLoading()');
  },
  
  async checkConsoleErrors() {
    console.log('üîß === CHECKING FOR CONSOLE ERRORS ===');
    
    // Check if the error capture script is available
    if (window.consoleErrorCapture) {
      const errors = window.consoleErrorCapture.getCapturedErrors();
      console.log('üìä Captured errors:', errors.length);
      
      const responseErrors = errors.filter(error => 
        error.message && (
          error.message.includes('marketplace_responses') ||
          error.message.includes('400') ||
          error.message.includes('Bad Request')
        )
      );
      
      console.log('üìä Response-related errors:', responseErrors.length);
      if (responseErrors.length > 0) {
        console.log('‚ùå Recent response errors:', responseErrors.slice(-3));
      } else {
        console.log('‚úÖ No response-related errors found');
      }
    } else {
      console.log('‚ö†Ô∏è Console error capture not available');
    }
  }
};

console.log('üîß Response fix test tools loaded. Run:');
console.log('   window.testResponseFix.testResponseLoading()');
console.log('   window.testResponseFix.checkConsoleErrors()');
